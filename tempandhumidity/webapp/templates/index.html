{% extends "layout.html" %}

{% block body %}
<script>
    setInterval(myTimer, 1000);
    
    function myTimer() {
      const d = new Date();
      document.getElementById("demo").innerHTML = d.toLocaleTimeString();
    }

    setInterval(new_data, 10000);
    var counter = 0;
    function new_data(){
      // Send a GET request to the URL
      fetch('http://23.119.121.13/query')
      // Put response into json form
      .then(response => response.json())
      .then(data => {
          // Log data to the console
          document.querySelector('#temp').innerHTML = data['temperature'];
          document.querySelector('#humid').innerHTML = data['humidity'];
          document.querySelector('#time').innerHTML = data['time'];
      });
    }

</script>

<!-- <p id="demo" style="float: right;"></p> -->
<script>

  function light(){
    // Send a GET request to the URL
    fetch('http://23.119.121.13/lights')
    const lightswitch = document.querySelector('.custom-control-label');
    if (lightswitch.innerHTML == "Turn off light"){
      lightswitch.innerHTML = "Turn on light";
    }
    else{
      lightswitch.innerHTML = "Turn off light";
    }
  }
</script>
<h2>Livestream</h2>
  <div>
      <!-- filling src with frames from webcam -->
      <img src="{{ url_for('video') }}" width="50%">
      <div class="custom-control custom-switch">
        <input type="checkbox" class="custom-control-input" id="customSwitch1" onclick="light()">
        <br>
        <label class="custom-control-label" for="customSwitch1">Turn on Light</label>
      </div>
      
  </div>


<h4 style="text-align: left;">Live Data</h4><h4 class="blob green"></h4>
<table class="table table-hover">
  <thead>
    <tr>
      <th scope="col">Temperature</th>
      <th scope="col">Humidity</th>
      <th scope="col">Timestamp</th>
    </tr>
  </thead>
<tbody>
    <tr>
      <td id="temp">Fetching...</td>
      <td id="humid">Fetching...</td>
      <td id="time">Fetching...<span></span></td>
    </tr>
  </tbody>
</table>

<br>
<br>
<h2>Data Analysis</h2>
<br>
<br>
<form action="/date" method="post">
    <label>From</label>
    <input autocomplete="off" autofocus name="date"  type="datetime-local" required="true"  min="2022-05-26T00:00" >
    <label>to</label>
    <input autocomplete="off" autofocus name="date2"  type="datetime-local" required="true" max="2022-05-29T12:00">
    <p></p>
    <select name="data" required="true">
        <option disabled selected value="">Data</option>
        <option value="Temperature">Temperature</option>
        <option value="Humidity">Humidity</option>
    </select>
    <select name="calculate" required="true">
        <option disabled selected value="">Calculate</option>
        <option value="Average">Average</option>
        <option value="Mininimum">Mininimum</option>
        <option value="Maximum">Maximum</option>
    </select>
    <input type="submit"class="btn btn-primary" value="Analyze" disabled="true">

</form>

<br>
<br>
<br>
<br>
<table class="table table-hover">
    <thead>
      <tr>
        <th scope="col">Recent Data</th>
        <th scope="col">Temperature</th>
        <th scope="col">Timestamp</th>
      </tr>
    </thead>
    <tbody>
    {% for item in cur %}
      <tr>
        <th scope="row">1</th>
        <td>{{ item[0] }}</td>
        <td>{{item[1]}}</td>
      </tr>
    {% endfor %}
    </tbody>
  </table>

{% endblock %}